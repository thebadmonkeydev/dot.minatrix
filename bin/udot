#!/usr/bin/env bash
#
# udot
#
# `udot` handles installation, updates, things like that. Run it periodically
# to make sure you're on the latest and greatest.

if [ -z ${DOTFILES+x} ];then
  export DOTFILES=~/dot.minatrix
fi

source $DOTFILES/script/helpers

ensure-sudo

# fork sudo heartbeat to prevent sudo timeout while installing
#while true; do sleep 60; sudo -n true; kill -0 "$$" || exit; done 2>/dev/null &

# Update package lists
inf "Updating package info"
apt update

# Upgrade installed packages
inf "Upgrading installed packages"
apt upgrade

# Re-run dot.minatrix install with update flag set
export DOTUPDATE=1
  inf "Running dot.minatrix install ($DOTFILES)/script/install"
  $DOTFILES/script/install
unset DOTUPDATE
